

# Nebulas 101 - 01 Compiler et Installer Nebulas

[YouTube Tutorial](https://www.youtube.com/watch?v=qtjss2LzSI4&list=PLFipfN18ZQwsW1_dge4w7dfsVNdNZZ37R)

Le projet [Nebulas](https://nebulas.io/) est disponible dans plusieurs versions testables et executables en local. Vous pouvez télécharger le code source de Nebulas pour compiler la blockchain en local.

Pour en savoir plus sur Nebulas, vous pouvez lire le [White Paper](https://nebulas.io/docs/NebulasWhitepaper.pdf) (version non technique) ou directement le code source de Nebulas [sur github](https://github.com/nebulasio/go-nebulas).

> A ce stade, Nebulas fonctionne uniquement sur Mac et Linux . La version Windows est en cours de dévelopement.

## Golang Environement

Actuellement, Nebulas est implémenté en Golang.

| Composants | Version | Description |
|----------|-------------|-------------|
|[Golang](https://golang.org) | >= 1.9.2| The Go Programming Language |

### Mac OSX

[Homebrew](https://brew.sh/) est recommandé pour l'installation de golang sur Mac.

```bash
# install
brew install go

# environment variables
export GOPATH=/path/to/workspace
```

> Notice: GOPATH est un repertoire local de golang working que vous pouvez déterminer. Une fois que GOPATH est configuré, votre projet go doit être placé dans le repertoire où se situe le repertoire GOPATH.

### Linux

```bash
# download
wget https://dl.google.com/go/go1.9.3.linux-amd64.tar.gz

# extract
tar -C /usr/local -xzf go1.9.3.linux-amd64.tar.gz

# environment variables
export PATH=$PATH:/usr/local/go/bin
export GOPATH=/path/to/workspace
```

## Compiler Nebulas

### Télécharger

Cloner le code source avec les commandes suivantes :

```bash
# enter workspace
mkdir -p $GOPATH/src/github.com/nebulasio
cd $GOPATH/src/github.com/nebulasio

# download
git clone https://github.com/nebulasio/go-nebulas.git

# enter repository
cd go-nebulas

# master branch is the most stable
git checkout master
```

### Installer RocksDB

* **OS X**:
* Install rocksdb via [Homebrew](https://brew.sh/)
```bash
brew install rocksdb
```

* **Linux - Ubuntu**
* Install Dependencies
```bash
apt-get update
apt-get -y install build-essential libgflags-dev libsnappy-dev zlib1g-dev libbz2-dev liblz4-dev libzstd-dev
```
* Install rocksdb by source code:
```bash
git clone https://github.com/facebook/rocksdb.git
cd rocksdb && make shared_lib && make install-shared
```

* **Linux - Centos**
* Install Dependencies
```bash
yum -y install epel-release && yum -y update
yum -y install gflags-devel snappy-devel zlib-devel bzip2-devel gcc-c++  libstdc++-devel
```
* Install rocksdb by source code:
```bash
git clone https://github.com/facebook/rocksdb.git
cd rocksdb && make shared_lib && make install-shared
```

### Installer les dépendances Go

Les dépendances Go dans Go-Nebulas sont gérés par [Dep](https://github.com/golang/dep).

| Composants | Version | Description |
|----------|-------------|-------------|
[Dep](https://github.com/golang/dep) | >= 0.3.1 | Dep is a dependency management tool for Go. |

#### Installer Dep

* **Mac OSX**
* Install Dep via [Homebrew](https://brew.sh/)
```bash
brew install dep
brew upgrade dep
```

* **Linux**
* Install dep
```bash
cd /usr/local/bin/
wget https://github.com/golang/dep/releases/download/v0.3.2/dep-linux-amd64
ln -s dep-linux-amd64 dep
```

#### Télécharger les dépendances

Placez-vous à la racine du projet afin de télécharger les dépendances pour Go-Nebulas:

```bash
cd $GOPATH/src/github.com/nebulasio/go-nebulas
make dep
```

> `make dep` downloads lots of dependencies. It might take a long time to download for the first time. Some dependencies may fail to download. If you can not download, you can directly download the zipped dependency files generated by dep [vendor.tar.gz](http://ory7cn4fx.bkt.clouddn.com/vendor.tar.gz) and extract it to the nebulas root directory.
> ```bash
> vendor.tar.gz
> MD5: c2c1ff9311332f90e11fb81b48ca0984
> ```

La machine virtuelle Nebulas dépends du moteur V8 JavaScript. Executez les commandes suivantes pour installer la dépendance v8 pour Mac/Linux.

```bash
cd $GOPATH/src/github.com/nebulasio/go-nebulas
make deploy-v8
```

### Build Neb

Vous pouvez maintenant construire l'executable pour Nebulas aprés que les dépendances golang et V8 soient installées.

Placez-vous sous le repertoire racine du projet:

```bash
cd $GOPATH/src/github.com/nebulasio/go-nebulas
make build
```

Une fois que la build de l'executation est terminée, vous trouverez un fichier executable `neb` généré sous le repertoire racine.
![make build](resources/101-01-make-build.png)


## Lancer NEB

### Genesis Block

Before launching a new Nebulas chain, we have to define the configuration of genesis block.

#### Genesis Block Configuration

```protobuf
# Neb genesis text file. Scheme is defined in core/pb/genesis.proto.

meta {
# Chain identity
chain_id: 100
}

consensus {
dpos {
# Initial dynasty, including all initial miners
dynasty: [
[ miner address ],
...
]
}
}

# Pre-allocation of initial tokens
token_distribution [
{
address: [ allocation address ]
value: [ amount of allocation tokens ]
},
...
]
```

Un exemple genesis.conf est disponible dans le repertoire suivant: `conf/default/genesis.conf`

### Configuration

Avant que le noeud neb soit lancé, nous devons définir sa configuration.

#### Neb Node Configuration

```protobuf
# Neb configuration text file. Scheme is defined in neblet/pb/config.proto:Config.

# Network Configuration
network {
# For the first node in a new Nebulas chain, `seed` is not need.
# Otherwise, every node needs some seed nodes to introduce it to the Nebulas chain.
# seed: ["/ip4/127.0.0.1/tcp/8680/ipfs/QmP7HDFcYmJL12Ez4ZNVCKjKedfE7f48f1LAkUc3Whz4jP"]

# P2p network service host. Support multiple IP and ports.
listen: ["0.0.0.0:8680"]

# The private key is used to generate a node ID. If you don't use the private key, the node will generate a new node ID.
# private_key: "conf/network/id_ed25519"
}

# Chain Configuration
chain {
# Network chain ID
chain_id: 100

# Database storage location
datadir: "data.db"

# Accounts' keystore files location
keydir: "keydir"

# The genesis block configuration
genesis: "conf/default/genesis.conf"

# Signature algorithm
signature_ciphers: ["ECC_SECP256K1"]

# Miner address
miner: "n1SAQy3ix1pZj8MPzNeVqpAmu1nCVqb5w8c"

# Coinbase address, all mining rewards received by the above miner will be sent to this address
coinbase: "n1FF1nz6tarkDVwWQkMnnwFPuPKUaQTdptE"

# The passphrase to the miner's keystore file
passphrase: "passphrase"
}

# API Configuration
rpc {
# GRPC API port
rpc_listen: ["127.0.0.1:8684"]

# HTTP API port
http_listen: ["127.0.0.1:8685"]

# The module opened
http_module: ["api", "admin"]
}

# Log Configuration
app {
# Log level: [debug, info, warn, error, fatal]
log_level: "info"

# Log location
log_file: "logs"

# Open crash log
enable_crash_report: false
}

# Metrics Configuration
stats {
# Open node metrics
enable_metrics: false

# Influxdb configuration
influxdb: {
host: "http://localhost:8086"
db: "nebulas"
user: "admin"
password: "admin"
}
}

```

Beaucoup d'exemples sont disponibles dans `$GOPATH/src/github.com/nebulasio/go-nebulas/conf/`

## Executer les noeuds

> A ce niveau, la chaine Nebulas que vous avez lancée est privée et est différente de celle du Testnet officiel ou du Mainnet.

Démarrer votre premier noeud Nebulas avec les commandes suivantes:

```bash
cd $GOPATH/src/github.com/nebulasio/go-nebulas
./neb -c conf/default/config.conf
```

Aprés le démarrage, vous devriez obtenir ce rendu dans le terminal:
![seed node start](resources/101-01-seed-node-start.png)

Par défaut, le neoud utilise `conf/default/config.conf` et ne mine pas de nouveaux blocs.
Démarrer votre premier noeud de minage Nebulas avec les commandes suivantes:

```bash
cd $GOPATH/src/github.com/nebulasio/go-nebulas
./neb -c conf/example/miner.conf
```

Aprés que le démarrage du noeud, si la connexion avec le noeud "seed" a réussi, vous pouvez voir le log suivant (qui se situe dans le fichier `logs/miner/neb.log`):
![node start](resources/101-01-node-start.png)

> Note: Vous pouvez démarrer plusieurs noeuds en local. Vérifiez cependant qu'aucun port ne rentrer en conflit avec d'autre noeud.

### Prochaine étape: Tutorial 2

[Envoyer des Transactions sur Nebulas](https://github.com/nebulasio/wiki/blob/master/tutorials/%5BEnglish%5D%20Nebulas%20101%20-%2002%20Transaction.md)

